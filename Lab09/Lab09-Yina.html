<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<h1 id="lab-9---hpc">Lab 9 - HPC</h1>
<p>10/14/2020</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(microbenchmark)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(parallel)</a></code></pre></div>
<h1 id="learning-goals">Learning goals</h1>
<p>In this lab, you are expected to learn/put in practice the following skills:</p>
<ul>
<li>Evaluate whether a problem can be parallelized or not.</li>
<li>Practice with the parallel package.</li>
<li>Use Rscript to submit jobs</li>
<li>Practice your skills with Git.</li>
</ul>
<h2 id="problem-1:-think">Problem 1: Think</h2>
<p>Give yourself a few minutes to think about what you just learned. List three examples of problems that you believe may be solved using parallel computing, and check for packages on the HPC CRAN task view that may be related to it.</p>
<ul>
<li>Monte Carlo Simulation (‘parallel’)</li>
<li>Bootstrapping (‘boot’)</li>
<li>Cross-validation in ML (‘mlr’, ’carat)</li>
</ul>
<h2 id="problem-2:-before-you">Problem 2: Before you</h2>
<p>The following functions can be written to be more efficient without using parallel:</p>
<ol>
<li>This function generates a <code>n x k</code> dataset with all its entries distributed poission with mean <code>lambda</code>.</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">fun1 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">lambda =</span> <span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">    x &lt;-<span class="st"> </span><span class="kw">rbind</span>(x, <span class="kw">rpois</span>(k, lambda))</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">fun1alt &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">lambda =</span> <span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"> <span class="kw">matrix</span>(<span class="kw">rpois</span>(n <span class="op">*</span><span class="st"> </span>k, <span class="dt">lambda =</span> lambda), <span class="dt">ncol =</span> k)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb2-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co"># Benchmarking</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="kw">fun1</span>(),</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="kw">fun1alt</span>(),<span class="dt">unit =</span> <span class="st">'relative'</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15">)</a></code></pre></div>
<pre><code>## Unit: relative
##       expr     min       lq     mean  median       uq      max neval
##     fun1() 14.0252 24.08261 14.80083 23.7231 23.83115 12.86837   100
##  fun1alt()  1.0000  1.00000  1.00000  1.0000  1.00000  1.00000   100
</code></pre>
<ol start="2">
<li>Find the column max (hint: Checkout the function <code>max.col()</code>).</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Data Generating Process (10 x 10,000 matrix)</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="fl">1e4</span>), <span class="dt">nrow=</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co"># Find each column's max value</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">fun2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  <span class="kw">apply</span>(x, <span class="dv">2</span>, max)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">fun2alt &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"> x[</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">    <span class="kw">cbind</span>(</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">      <span class="kw">max.col</span>(<span class="kw">t</span>(x)),</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">      <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(x))</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">    ]</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb4-17" data-line-number="17"></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co"># Benchmarking</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19">microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb4-20" data-line-number="20">  <span class="kw">fun2</span>(x),</a>
<a class="sourceLine" id="cb4-21" data-line-number="21">  <span class="kw">fun2alt</span>(x),<span class="dt">unit =</span> <span class="st">&quot;relative&quot;</span></a>
<a class="sourceLine" id="cb4-22" data-line-number="22">)</a></code></pre></div>
<pre><code>## Unit: relative
##        expr      min     lq     mean   median       uq      max neval
##     fun2(x) 9.640537 9.6312 6.807156 10.27637 10.19234 1.244931   100
##  fun2alt(x) 1.000000 1.0000 1.000000  1.00000  1.00000 1.000000   100
</code></pre>
<h2 id="problem-3:-parallelize-everyhing">Problem 3: Parallelize everyhing</h2>
<p>We will now turn our attention to non-parametric <a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">bootstrapping</a>. Among its many uses, non-parametric bootstrapping allow us to obtain confidence intervals for parameter estimates without relying on parametric assumptions.</p>
<p>The main assumption is that we can approximate many experiments by resampling observations from our original dataset, which reflects the population.</p>
<p>This function implements the non-parametric bootstrap:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">my_boot &lt;-<span class="st"> </span><span class="cf">function</span>(dat, stat, R, <span class="dt">ncpus =</span> 1L) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  </a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="co"># Getting the random indices</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(dat)</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  idx &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample.int</span>(n, n<span class="op">*</span>R, <span class="ot">TRUE</span>), <span class="dt">nrow=</span>n, <span class="dt">ncol=</span>R)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"> </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  <span class="co"># Making the cluster using `ncpus`</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">  <span class="co"># STEP 1: GOES HERE</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  cl &lt;-<span class="st"> </span><span class="kw">makePSOCKcluster</span>(ncpus)</a>
<a class="sourceLine" id="cb6-10" data-line-number="10">  <span class="co"># STEP 2: GOES HERE</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">  <span class="kw">clusterExport</span>(cl, <span class="dt">varlist =</span> <span class="kw">c</span>(<span class="st">&quot;idx&quot;</span>, <span class="st">&quot;dat&quot;</span>, <span class="st">&quot;stat&quot;</span>), <span class="dt">envir =</span> <span class="kw">environment</span>())</a>
<a class="sourceLine" id="cb6-12" data-line-number="12">    <span class="co"># STEP 3: THIS FUNCTION NEEDS TO BE REPLACES WITH parLapply</span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13">  ans &lt;-<span class="st"> </span><span class="kw">parLapply</span>(cl,<span class="kw">seq_len</span>(R), <span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">    <span class="kw">stat</span>(dat[idx[,i], , <span class="dt">drop=</span><span class="ot">FALSE</span>])</a>
<a class="sourceLine" id="cb6-15" data-line-number="15">  })</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb6-17" data-line-number="17">  <span class="co"># Coercing the list into a matrix</span></a>
<a class="sourceLine" id="cb6-18" data-line-number="18">  ans &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, ans)</a>
<a class="sourceLine" id="cb6-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb6-20" data-line-number="20">  <span class="co"># STEP 4: GOES HERE</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21">  <span class="kw">stopCluster</span>(cl)</a>
<a class="sourceLine" id="cb6-22" data-line-number="22">  ans</a>
<a class="sourceLine" id="cb6-23" data-line-number="23">  </a>
<a class="sourceLine" id="cb6-24" data-line-number="24">}</a></code></pre></div>
<ol>
<li>Use the previous pseudocode, and make it work with parallel. Here is just an example for you to try:</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Bootstrap of an OLS</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">my_stat &lt;-<span class="st"> </span><span class="cf">function</span>(d) <span class="kw">coef</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data=</span>d))</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co"># DATA SIM</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="kw">set.seed</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6">n &lt;-<span class="st"> </span><span class="dv">500</span>; R &lt;-<span class="st"> </span><span class="fl">1e4</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">x &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n)); y &lt;-<span class="st"> </span>x<span class="op">*</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co"># Checking if we get something similar as lm</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">ans0 &lt;-<span class="st"> </span><span class="kw">confint</span>(<span class="kw">lm</span>(y<span class="op">~</span>x))</a>
<a class="sourceLine" id="cb7-12" data-line-number="12">ans1 &lt;-<span class="st"> </span><span class="kw">my_boot</span>(<span class="dt">dat =</span> <span class="kw">data.frame</span>(x, y), my_stat, <span class="dt">R =</span> R, <span class="dt">ncpus =</span> 2L)</a>
<a class="sourceLine" id="cb7-13" data-line-number="13"></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co"># You should get something like this</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="kw">t</span>(<span class="kw">apply</span>(ans1, <span class="dv">2</span>, quantile, <span class="kw">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>)))</a></code></pre></div>
<pre><code>##                   2.5%      97.5%
## (Intercept) -0.1386903 0.04856752
## x            4.8685162 5.04351239
</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">##                   2.5%      97.5%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">## (Intercept) -0.1372435 0.05074397</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">## x            4.8680977 5.04539763</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">ans0</a></code></pre></div>
<pre><code>##                  2.5 %     97.5 %
## (Intercept) -0.1379033 0.04797344
## x            4.8650100 5.04883353
</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">##                  2.5 %     97.5 %</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co">## (Intercept) -0.1379033 0.04797344</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">## x            4.8650100 5.04883353</span></a></code></pre></div>
<ol start="2">
<li>Check whether your version actually goes faster than the non-parallel version:</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">system.time</span>(<span class="kw">my_boot</span>(<span class="dt">dat =</span> <span class="kw">data.frame</span>(x, y), my_stat, <span class="dt">R =</span> <span class="dv">4000</span>, <span class="dt">ncpus =</span> 1L))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.140   0.021   7.296
</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">system.time</span>(<span class="kw">my_boot</span>(<span class="dt">dat =</span> <span class="kw">data.frame</span>(x, y), my_stat, <span class="dt">R =</span> <span class="dv">4000</span>, <span class="dt">ncpus =</span> 2L))</a></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.232   0.031   5.855
</code></pre>
<h2 id="problem-4:-compile-this-markdown-document-using-rscript">Problem 4: Compile this markdown document using Rscript</h2>
<p>Once you have saved this Rmd file, try running the following command in your terminal:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="ex">Rscript</span> --vanilla -e <span class="st">'rmarkdown::render(&quot;[full-path-to-your-Rmd-file.Rmd]&quot;)'</span> <span class="kw">&amp;</span></a></code></pre></div>
<p>Where <code>[full-path-to-your-Rmd-file.Rmd]</code> should be replace with the full path to your Rmd file… :).</p>

</body>
</html>
